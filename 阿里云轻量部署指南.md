# é˜¿é‡Œäº‘è½»é‡æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸš€ ä¸€é”®éƒ¨ç½²

### å‰ææ¡ä»¶
1. **é˜¿é‡Œäº‘è½»é‡æœåŠ¡å™¨**ï¼ˆæ¨èé…ç½®ï¼š2æ ¸2Gï¼Œç³»ç»Ÿç›˜40G+ï¼‰
2. **ç³»ç»Ÿ**ï¼šUbuntu 20.04+ æˆ– CentOS 7+
3. **æœ¬åœ°ç¯å¢ƒ**ï¼šå®‰è£…äº†Gitã€Node.jsã€SSH

### Step 1: é…ç½®SSHå¯†é’¥ï¼ˆé‡è¦ï¼ï¼‰

```bash
# 1. ç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t rsa -b 4096 -C "your-email@example.com"

# 2. å¤åˆ¶å…¬é’¥åˆ°æœåŠ¡å™¨
ssh-copy-id root@ä½ çš„æœåŠ¡å™¨IP

# 3. æµ‹è¯•è¿æ¥
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

### Step 2: ä¸€é”®éƒ¨ç½²

```bash
# è®¾ç½®æœåŠ¡å™¨IPå¹¶éƒ¨ç½²
SERVER_IP=ä½ çš„æœåŠ¡å™¨IP ./deploy-aliyun-light.sh

# æˆ–è€…ç›´æ¥ä¿®æ”¹è„šæœ¬ä¸­çš„IPåœ°å€åè¿è¡Œ
./deploy-aliyun-light.sh
```

## ğŸ“‹ éƒ¨ç½²æµç¨‹è¯¦è§£

### è‡ªåŠ¨å®Œæˆçš„æ“ä½œï¼š
1. âœ… **ä»£ç å‡†å¤‡**ï¼šè‡ªåŠ¨æäº¤æœ¬åœ°å˜æ›´
2. âœ… **å‰ç«¯æ„å»º**ï¼šnpm buildç”Ÿæˆdistç›®å½•  
3. âœ… **æœåŠ¡å™¨æ£€æŸ¥**ï¼šæ£€æŸ¥Dockerç¯å¢ƒï¼Œè‡ªåŠ¨å®‰è£…ç¼ºå¤±ç»„ä»¶
4. âœ… **ä»£ç åŒæ­¥**ï¼šrsyncé«˜æ•ˆåŒæ­¥åˆ°æœåŠ¡å™¨
5. âœ… **æœåŠ¡éƒ¨ç½²**ï¼šDocker Composeå¯åŠ¨æ‰€æœ‰æœåŠ¡
6. âœ… **å¥åº·æ£€æŸ¥**ï¼šéªŒè¯å‰åç«¯æœåŠ¡çŠ¶æ€

### æœåŠ¡ç«¯å£ï¼š
- **å‰ç«¯**ï¼š80ç«¯å£
- **åç«¯API**ï¼š10000ç«¯å£  
- **Nginxå¥åº·æ£€æŸ¥**ï¼š/health

## ğŸ”§ é«˜çº§é…ç½®

### åŸŸåé…ç½®
å¦‚æœä½ æœ‰åŸŸåï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```bash
# 1. è®¾ç½®åŸŸåç¯å¢ƒå˜é‡
DOMAIN=yourdomain.com SERVER_IP=ä½ çš„IP ./deploy-aliyun-light.sh

# 2. ä¿®æ”¹nginxé…ç½®ä¸­çš„server_name
# nginx.conf: server_name yourdomain.com;
```

### SSLè¯ä¹¦é…ç½®
```bash
# æ–¹æ¡ˆä¸€ï¼šé˜¿é‡Œäº‘å…è´¹SSLè¯ä¹¦ï¼ˆæ¨èï¼‰
# 1. é˜¿é‡Œäº‘æ§åˆ¶å°ç”³è¯·SSLè¯ä¹¦
# 2. ä¸‹è½½nginxæ ¼å¼è¯ä¹¦
# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨/etc/nginx/ssl/

# æ–¹æ¡ˆäºŒï¼šLet's Encryptè‡ªåŠ¨è¯ä¹¦
ssh root@ä½ çš„æœåŠ¡å™¨IP
apt install certbot python3-certbot-nginx
certbot --nginx -d yourdomain.com
```

## ğŸ› ï¸ è¿ç»´ç®¡ç†

### å¸¸ç”¨å‘½ä»¤
```bash
# SSHè¿æ¥æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/habit

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# å®Œå…¨é‡æ–°æ„å»º
docker-compose down
docker-compose up -d --build
```

### ç›‘æ§æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡å¥åº·
curl http://ä½ çš„æœåŠ¡å™¨IP/health
curl http://ä½ çš„æœåŠ¡å™¨IP:10000/api/health

# æŸ¥çœ‹æœåŠ¡å™¨èµ„æº
htop
df -h
free -h

# æŸ¥çœ‹Dockerèµ„æº
docker stats
```

## ğŸš¨ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ— æ³•è¿æ¥æœåŠ¡å™¨
```bash
# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
ufw status
# å¼€æ”¾å¿…è¦ç«¯å£
ufw allow 22    # SSH
ufw allow 80    # HTTP  
ufw allow 443   # HTTPS
ufw allow 10000 # API
```

### é—®é¢˜2ï¼šDockeræœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs backend
docker-compose logs frontend

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :80
netstat -tlnp | grep :10000

# é‡ç½®Docker
docker system prune -a
```

### é—®é¢˜3ï¼šå‰ç«¯é¡µé¢ç©ºç™½
```bash
# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la dist/

# æ£€æŸ¥nginxé…ç½®
nginx -t

# é‡æ–°æ„å»ºå‰ç«¯
npm run build
docker-compose restart frontend
```

## ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### è½»é‡æœåŠ¡å™¨ä¼˜åŒ–ï¼š
1. **å¼€å¯Gzipå‹ç¼©**ï¼šå·²åœ¨nginx.confä¸­é…ç½®
2. **é™æ€èµ„æºç¼“å­˜**ï¼šå·²é…ç½®1å¹´ç¼“å­˜
3. **æ•°æ®åº“ä¼˜åŒ–**ï¼šè€ƒè™‘ä½¿ç”¨é˜¿é‡Œäº‘RDS
4. **CDNåŠ é€Ÿ**ï¼šæ¥å…¥é˜¿é‡Œäº‘CDN

### ç›‘æ§å‘Šè­¦ï¼š
```bash
# å®‰è£…ç›‘æ§å·¥å…·
apt install htop iotop nethogs

# è®¾ç½®å®šæ—¶ä»»åŠ¡æ£€æŸ¥æœåŠ¡
crontab -e
# æ·»åŠ ï¼š*/5 * * * * curl -f http://localhost/health || systemctl restart docker
```

## ğŸ¯ æˆåŠŸéƒ¨ç½²éªŒè¯æ¸…å•

- [ ] å‰ç«¯é¦–é¡µæ­£å¸¸è®¿é—®ï¼šhttp://ä½ çš„IP
- [ ] åç«¯APIå¥åº·æ£€æŸ¥ï¼šhttp://ä½ çš„IP:10000/api/health
- [ ] è¯Šæ–­åŠŸèƒ½æ­£å¸¸ï¼šå¯ä»¥å®Œæˆ19é¢˜é—®å·
- [ ] æ•°æ®ä¿å­˜æ­£å¸¸ï¼šåç«¯æ•°æ®åº“æœ‰è®°å½•
- [ ] è´­ç‰©è½¦åŠŸèƒ½ï¼šæ·»åŠ å•†å“æ­£å¸¸
- [ ] å“åº”å¼è®¾è®¡ï¼šæ‰‹æœºè®¿é—®æ­£å¸¸

## ğŸ”„ æ—¥å¸¸ç»´æŠ¤

### æ›´æ–°ä»£ç ï¼š
```bash
# æœ¬åœ°ä¿®æ”¹ä»£ç å
git add .
git commit -m "æ›´æ–°åŠŸèƒ½"
git push

# æœåŠ¡å™¨æ›´æ–°ï¼ˆæ–¹æ³•ä¸€ï¼šé‡æ–°éƒ¨ç½²ï¼‰
SERVER_IP=ä½ çš„IP ./deploy-aliyun-light.sh

# æœåŠ¡å™¨æ›´æ–°ï¼ˆæ–¹æ³•äºŒï¼šæ‰‹åŠ¨ï¼‰
ssh root@ä½ çš„IP
cd /var/www/habit
git pull
docker-compose up -d --build
```

### æ•°æ®å¤‡ä»½ï¼š
```bash
# å¤‡ä»½æ•°æ®åº“
docker exec habit-backend cp /app/instance/insomnia_diagnosis.db /app/backup/
```

---

**éƒ¨ç½²æˆåŠŸåè®¿é—®ï¼š**
- ğŸŒ å‰ç«¯ï¼šhttp://ä½ çš„æœåŠ¡å™¨IP  
- ğŸ”§ APIï¼šhttp://ä½ çš„æœåŠ¡å™¨IP:10000/api/health
- ğŸ“± æ‰‹æœºç«¯ï¼šåŒæ ·åœ°å€ï¼Œè‡ªé€‚åº”å“åº”å¼è®¾è®¡

**æœ‰é—®é¢˜åŠ æˆ‘å¾®ä¿¡ï¼š** `ä½ çš„å¾®ä¿¡å·`